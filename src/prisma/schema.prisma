// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Storage {
  cid  String @id
  name String
  ipfs String
}

model IID {
  id                   String           @id
  publicKey            String?
  context              Context[]
  controller           String[]
  verificationMethod   Json?
  service              Service[]
  authentication       String[]
  assertionMethod      String[]
  keyAgreement         String[]
  capabilityInvocation String[]
  capabilityDelegation String[]
  linkedResource       LinkedResource[]
  linkedClaim          LinkedClaim[]
  accordedRight        AccordedRight[]
  linkedEntity         LinkedEntity[]
  alsoKnownAs          String
  metadata             Json?
  Entity               Entity?
}

model Context {
  aid Int    @id @default(autoincrement())
  IID IID    @relation(fields: [iid], references: [id])
  iid String
  key String
  val String
}

model Service {
  aid             Int    @id @default(autoincrement())
  id              String
  type            String
  serviceEndpoint String
  IID             IID    @relation(fields: [iid], references: [id])
  iid             String
}

model LinkedResource {
  aid             Int    @id @default(autoincrement())
  type            String
  id              String
  description     String
  mediaType       String
  serviceEndpoint String
  proof           String
  encrypted       String
  right           String
  IID             IID    @relation(fields: [iid], references: [id])
  iid             String
}

model LinkedClaim {
  aid             Int    @id @default(autoincrement())
  id              String
  type            String
  description     String
  serviceEndpoint String
  proof           String
  encrypted       String
  right           String
  IID             IID    @relation(fields: [iid], references: [id])
  iid             String
}

model AccordedRight {
  aid       Int    @id @default(autoincrement())
  type      String
  id        String
  mechanism String
  message   String
  service   String
  IID       IID    @relation(fields: [iid], references: [id])
  iid       String
}

model LinkedEntity {
  aid          Int    @id @default(autoincrement())
  type         String
  id           String
  relationship String
  service      String
  IID          IID    @relation(fields: [iid], references: [id])
  iid          String
}

model Entity {
  IID            IID       @relation(fields: [id], references: [id])
  id             String    @id
  type           String
  startDate      DateTime?
  endDate        DateTime?
  status         Int
  relayerNode    String
  credentials    String[]
  entityVerified Boolean
  metadata       Json?
}

model ClaimCollection {
  id        String    @id
  entity    String
  admin     String
  protocol  String
  startDate DateTime?
  endDate   DateTime?
  quota     Int
  count     Int
  evaluated Int
  approved  Int
  rejected  Int
  disputed  Int
  state     String
  payments  Json?
}

model IClaim {
  claimId        String    @id
  collectionId   String
  agentDid       String
  agentAddress   String
  submissionDate DateTime?
  evaluation     Json?
  paymentsStatus Json?
}

model Dispute {
  proof     String @id
  subjectId String
  type      Int
  data      Json?
}

model TokenClass {
  contractAddress String  @id
  minter          String
  class           String
  name            String
  description     String
  image           String
  type            String
  cap             String
  supply          String
  paused          Boolean
  stopped         Boolean
  retired         Json?
  cancelled       Json?
}

model Token {
  id         String @id
  index      String
  name       String
  collection String
  tokenData  Json?
}

model Bond {
  bondDid                  String              @id
  status                   String?
  token                    String
  name                     String
  description              String
  functionType             String
  functionParamaters       Json?
  creatorDid               String
  controllerDid            String
  reserveTokens            String[]
  txFeePercentage          String
  exitFeePercentage        String
  feeAddress               String
  reserveWithdrawalAddress String
  maxSupply                Json?
  orderQuantityLimits      Json?
  sanityRate               String
  sanityMarginPercentage   String
  allowSells               Boolean?
  allowReserveWithdrawals  Boolean?
  alphaBond                Boolean?
  batchBlocks              String
  creatorAddress           String
  editorDid                String?
  editorAddress            String?
  PriceEntry               PriceEntry[]
  AlphaChange              Alpha[]
  BondBuy                  BondBuy[]
  ShareWithdrawal          ShareWithdrawal[]
  ReserveWithdrawal        ReserveWithdrawal[]
  OutcomePayment           OutcomePayment[]
  BondSell                 BondSell[]
  BondSwap                 BondSwap[]
}

model PriceEntry {
  id      Int      @id @default(autoincrement())
  bond    Bond     @relation(fields: [bondDid], references: [bondDid])
  bondDid String
  time    DateTime
  denom   String
  price   Decimal
}

model BondBuy {
  id           Int    @id @default(autoincrement())
  bond         Bond   @relation(fields: [bondDid], references: [bondDid])
  bondDid      String
  buyerDid     String
  buyerAddress String
  amount       String
  maxPrices    Json?
}

model BondSell {
  id            Int    @id @default(autoincrement())
  bond          Bond   @relation(fields: [bondDid], references: [bondDid])
  bondDid       String
  sellerDid     String
  sellerAddress String
  amount        String
}

model BondSwap {
  id             Int    @id @default(autoincrement())
  bond           Bond   @relation(fields: [bondDid], references: [bondDid])
  bondDid        String
  swapperDid     String
  swapperAddress String
  from           Json?
  toToken        String
}

model Alpha {
  id            Int    @id @default(autoincrement())
  bond          Bond   @relation(fields: [bondDid], references: [bondDid])
  bondDid       String
  alpha         String
  delta         String
  oracleDid     String
  oracleAddress String
  height        String
  timestamp     String
}

model OutcomePayment {
  id            Int    @id @default(autoincrement())
  bond          Bond   @relation(fields: [bondDid], references: [bondDid])
  bondDid       String
  senderDid     String
  senderAddress String
  amount        String
  height        String
  timestamp     String
}

model ReserveWithdrawal {
  id                Int    @id @default(autoincrement())
  bond              Bond   @relation(fields: [bondDid], references: [bondDid])
  bondDid           String
  withdrawerDid     String
  withdrawerAddress String
  amount            Json?
  height            String
  timestamp         String
}

model ShareWithdrawal {
  id               Int    @id @default(autoincrement())
  bond             Bond   @relation(fields: [bondDid], references: [bondDid])
  bondDid          String
  recipientDid     String
  recipientAddress String
  height           String
  timestamp        String
}

model Chain {
  chainId     String @id
  blockHeight Int
}

model Event {
  id          Int      @id @default(autoincrement())
  type        String
  attributes  Json?
  blockHeight Int
  timestamp   DateTime
}

model Stats {
  id                    Int      @id @default(autoincrement())
  totalServiceProviders Int
  totalProjects         Int
  totalEvaluationAgents Int
  totalInvestors        Int
  totalClaims           Int
  successfulClaims      Int
  submittedClaims       Int
  pendingClaims         Int
  rejectedClaims        Int
  claimLocations        String[]
}

model Project {
  projectDid              String           @id
  txHash                  String
  senderDid               String
  pubKey                  String
  data                    Json?
  projectAddress          String
  status                  String?
  entityType              String?
  createdOn               DateTime
  createdBy               String
  successfulClaims        Int
  rejectedClaims          Int
  evaluators              Int
  evaluatorsPending       Int
  serviceProviders        Int
  serviceProvidersPending Int
  investors               Int
  investorsPending        Int
  Agent                   Agent[]
  Claim                   Claim[]
  FundWithdrawal          FundWithdrawal[]
}

model Agent {
  id         Int     @id @default(autoincrement())
  agentDid   String
  project    Project @relation(fields: [projectDid], references: [projectDid])
  projectDid String
  status     String
  role       String
}

model Claim {
  claimId         String  @id
  project         Project @relation(fields: [projectDid], references: [projectDid])
  projectDid      String
  claimTemplateId String
  status          String
}

model FundWithdrawal {
  id            Int      @id @default(autoincrement())
  project       Project  @relation(fields: [projectDid], references: [projectDid])
  projectDid    String
  senderDid     String
  senderAddress String
  recipientDid  String
  amount        String
  isRefund      Boolean?
}

model PaymentTemplate {
  id             String @id
  paymentAmount  Json?
  paymentMinimum Json?
  paymentMaximum Json?
  discounts      Json?
  creatorDid     String
  creatorAddress String
}

model PaymentContract {
  id                String         @id
  paymentTemplateId String
  payer             String
  recipients        Json?
  canDeauthorise    Boolean
  authorised        Boolean?
  payerDid          String?
  effected          Boolean?
  senderDid         String?
  creatorDid        String
  creatorAddress    String
  Subscription      Subscription[]
  Discount          Discount[]
}

model Subscription {
  id                String          @id
  paymentContract   PaymentContract @relation(fields: [paymentContractId], references: [id])
  paymentContractId String
  maxPeriods        String
  period            Json?
  creatorDid        String
  creatorAddress    String
}

model Discount {
  id                String          @id
  paymentContract   PaymentContract @relation(fields: [paymentContractId], references: [id])
  paymentContractId String
  recipient         String
  granter           String
  revoked           Boolean?
  revoker           String?
}

model Transaction {
  hash      String    @id
  height    Int
  code      Int
  fee       Json?
  gasUsed   String
  gasWanted String
  time      DateTime
  messages  Message[]
}

model Message {
  id              Int         @id @default(autoincrement())
  Transaction     Transaction @relation(fields: [transactionHash], references: [hash])
  transactionHash String
  typeUrl         String
  value           Json?
  from            String?
  to              String?
}

model Block {
  height           Int      @id
  hash             String
  num_txs          Int      @default(0)
  total_gas        Int      @default(0)
  proposer_address String?
  timestamp        DateTime
}
